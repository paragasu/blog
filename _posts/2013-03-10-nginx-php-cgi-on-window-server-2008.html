---
layout: post
title: nginx + php-cgi on window server 2008
date: 2013-03-10 13:19:54.000000000 +08:00
type: post
published: true
status: publish
categories:
- Linux
- php
tags:
- nginx window
- php-cgi window
- window server 2008
meta:
  _edit_last: '5225680'
  _publicize_pending: '1'
author:
  login: paragasu
  email: paragasu@gmail.com
  display_name: paragasu
  first_name: ''
  last_name: ''
---
<p>php-cgi.php just hang and die on a very low load.</p>
<p>To fix this, use <a href="https://bitbucket.org/cybergene/spawn-php/wiki/Home">spawn-php</a></p>
<p>Install<br />
<code><br />
ActivePython-2.7.2.5-win64-x64.msi<br />
pywin32-217.win-amd64-py2.7.exe<br />
</code></p>
<p>Change nginx configuration<br />
<code><br />
worker_processes  1;</p>
<p>events {<br />
    worker_connections  1024;<br />
}</p>
<p>http {<br />
   include       mime.types;<br />
   default_type  application/octet-stream;</p>
<p>   sendfile        on;<br />
   keepalive_timeout  65;</p>
<p>   upstream php_farm {<br />
       server 127.0.0.1:9000 weight=1;<br />
       server 127.0.0.1:9001 weight=1;<br />
       server 127.0.0.1:9002 weight=1;<br />
       server 127.0.0.1:9003 weight=1;<br />
       server 127.0.0.1:9004 weight=1;<br />
       server 127.0.0.1:9005 weight=1;<br />
       server 127.0.0.1:9006 weight=1;<br />
       server 127.0.0.1:9007 weight=1;<br />
       server 127.0.0.1:9008 weight=1;<br />
       server 127.0.0.1:9009 weight=1;<br />
    }</p>
<p>    server {<br />
       listen       80;<br />
       server_name  localhost;<br />
       location / {<br />
            root   html;<br />
            index  index.php index.html index.htm;<br />
        }</p>
<p>        error_page   500 502 503 504  /50x.html;<br />
        location = /50x.html {<br />
            root   html;<br />
        }   </p>
<p>        location ~ \.php$ {<br />
            root           html;<br />
            fastcgi_pass   php_farm;<br />
            fastcgi_index  index.php;<br />
            fastcgi_param  SCRIPT_FILENAME  c:/nginx/html/$fastcgi_script_name;<br />
            include        fastcgi_params;<br />
        }<br />
    }<br />
}<br />
</code></p>
